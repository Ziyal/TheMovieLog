@Html.Partial("Navbar-LoggedIn")

<div class="search_container">
    <input type="text" class="input_movie form-control">
    <input type="submit" class="add_movie btn btn-block" value="Add">
</div>

<script type="text/javascript">
    $(function() {

        $(document).on("click", ".add_movie", search);
        $(document).on("click", ".result_select", sendToServer);

        function search() {
            $(".search_results").empty();

            var movie = $(".input_movie").val().trim();
            var query = "https://api.themoviedb.org/3/search/movie?api_key=eab968ac592b5893e49606022d016228&language=en-US&query=" + movie + "&page=1&include_adult=false"

            $.ajax({
                type: "GET",
                url: query
            }).done(function(response){

                $(".results_title").empty();
                $(".results_title").append("<h3>Which movie?</h3><hr>");

                for(var item = 0; item < 10; item++) {
                    
                    $(".search_results").append("<h3 class='result_title'>"+response.results[item].title+"</h3>");
                    $(".search_results").append("<p class='result_release'>"+response.results[item].release_date+"</p>");
                    $(".search_results").append("<p class='result_select response_summary'>"+response.results[item].overview+"</p>");
                    $(".search_results").append("<img src='https://image.tmdb.org/t/p/w500"+response.results[item].poster_path+"' style='max-width:200px;max-height:150px' class='result_image'>"); 
                    $(".search_results").append("<button name='button' class='result_select' movie_id='"+response.results[item].id+"'movie_title='"+response.results[item].title+"' movie_release='"+response.results[item].release_date+"'>Choose Film</button><hr>");
                }
            });
        }


        function sendToServer() {

            alert("inside function")
            
            var params = JSON.stringify({
                Id: $("button").attr("movie_id"),
                Title: $("button").attr("movie_title"),
                Release: $("button").attr("movie_release")
            });

            $.ajax({
                type: "POST",
                url: "SendToServer.aspx/SelectedMovie",
                data: params,
                contentType: "applications/json; charset=utf-8",
                dataType: "json",
                success: function(response) {
                    source = $.parseJson(response.d);
                },
                error: function(err) {
                    alert("Error")
                }
            })

        }

    });

</script>

<div class="results_container">
    <div class="results_title"></div>
    <div class="search_results"></div>
</div>
